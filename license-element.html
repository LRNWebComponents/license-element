<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../hax-body-behaviors/hax-body-behaviors.html">
<link rel="import" href="../schema-behaviors/schema-behaviors.html">

<!--
`license-element`
A simple way of applying a semantically accurate license to work.

@demo demo/index.html

@microcopy - the mental model for this element

-->

<dom-module id="license-element">
  <template>
    <style>
      :host {
        display: block;
        font-size: 11px;
        --license-text-color: #222222;
        --license-background-color: #F2F2F2;
        background-color: var(--license-background-color);
      }
      .license-body {
        padding: 16px;
        font-style: italic;
        color: var(--license-text-color);
        @apply --license-body;
      }
      :host[display-method="footnote"] {
        visibility: hidden;
        opacity: 0;
      }
      :host[display-method="popup"] {
        display: block;
      }
      .license-link {
        line-height: 16px;
        font-style: italic;
        @apply --license-link;
      }
      .citation-date {
        line-height: 16px;
        font-style: italic;
        @apply --license-date;
      }
      .license-link img {
        height: 16px;
        min-width: 16px;
        margin-right: 8px;
      }
    </style>
    <meta rel="cc:license" href$="[[licenseLink]]" content$="License: [[licenseName]]">
    <div class="license-body" xmlns:cc$="[[licenseLink]]" xmlns:dc="http://purl.org/dc/elements/1.1/">

      <span rel="dc:type" href="http://purl.org/dc/dcmitype/Text" property="dc:title">[[title]]</span> by <a rel="cc:attributionURL" property="cc:attributionName" href$="[[source]]">[[creator]]</a> is licensed under a <a class="license-link" target="_blank" href="[[licenseLink]]"><img alt="[[licenseName]] graphic" src="[[licenseImage]]" hidden&="[[!licenseImage]]" />[[licenseName]]</a>

      <span rel="dc:source" href$="[[source]]"></span>
      Permissions beyond the scope of this license may be available at <a rel="cc:morePermissions" href="[[moreLink]]">[[moreLabel]]</a>.
    </div>
  </template>

  <script>
    Polymer({

      is: 'license-element',
      behaviors: [
        HAXBehaviors.PropertiesBehaviors,
        SchemaBehaviors.Schema
      ],
      properties: {
        /**
         * Title of the work.
         */
        title: {
          type: String,
        },
        /**
         * Person or group that owns / created the work.
         */
        creator: {
          type: String,
        },
        /**
         * Original Source of the work in question
         */
        source: {
          type: String,
        },
        /**
         * Date the work was accessed.
         */
        date: {
          type: String,
        },
        /**
         * License name, calculated or supplied by the end user if we don't have them.
         */
        licenseName: {
          type: String,
        },
        /**
         * License link for more details
         */
        licenseLink: {
          type: String,
        },
        /**
         * License short hand. Options cc0,
         */
        license: {
          type: String,
          observer: '_licenseUpdated',
        },
      },
      /**
       * Attached to the DOM, now fire.
       */
      attached: function() {
        // Establish hax property binding
        let props = {
          'canScale': false,
          'canPosition': false,
          'canEditSource': false,
          'gizmo': {
            'title': 'Citation',
            'description': 'A basic citation element with 3 presentation modes',
            'icon': 'editor:title',
            'color': 'grey',
            'groups': ['Content', 'Text', 'Copyright'],
            'handles': [
              {
                'type': 'citation',
                'source': 'source',
                'title': 'title',
                'author': 'creator',
                'license': 'license',
                'accessDate': 'date'
              },
              {
                'type': 'inline',
                'text': 'title'
              },
            ],
            'meta': {
              'author': 'LRNWebComponents'
            }
          },
          'settings': {
            'quick': [
              {
                'property': 'title',
                'title': 'Title',
                'description': 'The title of the work being cited.',
                'inputMethod': 'textfield',
                'icon': 'editor:title',
              },
              {
                'property': 'source',
                'title': 'Source link',
                'description': 'The source url for the element this is citing.',
                'inputMethod': 'textfield',
                'icon': 'link',
                'validationType': 'url',
              },
              {
                'property': 'date',
                'title': 'Date accessed',
                'description': 'The date this was accessed.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
              {
                'property': 'license',
                'title': 'License',
                'description': 'The source url for the element this is citing.',
                'inputMethod': 'select',
                'options': this.licenseList('select'),
                'icon': 'link',
              },
              {
                'property': 'creator',
                'title': 'Creator',
                'description': 'Who made or owns this.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
            ],
            'configure': [
              {
                'property': 'title',
                'title': 'Title',
                'description': 'The title of the work being cited.',
                'inputMethod': 'textfield',
                'icon': 'editor:title',
              },
              {
                'property': 'source',
                'title': 'Source link',
                'description': 'The source url for the element this is citing.',
                'inputMethod': 'textfield',
                'icon': 'link',
                'validationType': 'url',
              },
              {
                'property': 'date',
                'title': 'Date accessed',
                'description': 'The date this was accessed.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
              {
                'property': 'license',
                'title': 'License',
                'description': 'The source url for the element this is citing.',
                'inputMethod': 'select',
                'options': this.licenseList('select'),
                'icon': 'link',
              },
              {
                'property': 'creator',
                'title': 'Creator',
                'description': 'Who made or owns this.',
                'inputMethod': 'textfield',
                'icon': 'link',
              },
            ],
            'advanced': [
            ]
          }
        };
        this.setHaxProperties(props);
      },
      /**
       * A list of licenses that we support the references for.
       */
      licenseList: function(mode = 'full') {
        // initial list, PR to add more
        let list = {
          'by': {
            'name': 'Attribution',
            'link': 'https://creativecommons.org/licenses/by/4.0/',
            'image': 'https://i.creativecommons.org/l/by/4.0/88x31.png',
          },
          'by-sa': {
            'name': 'Attribution Share a like',
            'link': 'https://creativecommons.org/licenses/by-sa/4.0/',
            'image': 'https://i.creativecommons.org/l/by-sa/4.0/88x31.png',
          },
          'by-nd': {
            'name': 'Attribution No derivatives',
            'link': 'https://creativecommons.org/licenses/by-nd/4.0/',
            'image': 'https://i.creativecommons.org/l/by-nd/4.0/88x31.png',
          },
          'by-nc': {
            'name': 'Attribution non-commercial',
            'link': 'https://creativecommons.org/licenses/by-nc/4.0/',
            'image': 'https://i.creativecommons.org/l/by-nc/4.0/88x31.png',
          },
          'by-nc-sa': {
            'name': 'Attribution non-commercial share a like',
            'link': 'https://creativecommons.org/licenses/by-nc-sa/4.0/',
            'image': 'https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png',
          },
          'by-nc-nd': {
            'name': 'Attribution Non-commercial No derivatives',
            'link': 'https://creativecommons.org/licenses/by-nc-nd/4.0/',
            'image': 'https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png',
          },
        };
        // support mutating the array into a select list
        if (mode == 'select') {
          var select = {};
          for (var i in list) {
            select[i] = list[i].name;
          }
          return select;
        }
        return list;
      },
      /**
       * License was updated, time to update license name and link.
       */
      _licenseUpdated: function(newValue, oldValue) {
        if (typeof newValue !== typeof undefined) {
          var list = this.licenseList();
          if (typeof list[newValue] !== typeof undefined) {
            this.licenseName = list[newValue].name;
            this.licenseLink = list[newValue].link;
            this.licenseImage = list[newValue].image;
          }
        }
      },
    });
  </script>
</dom-module>
